<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <title>game</title>
  <link rel="stylesheet" href="./css/bootstrap.css">
  <script src="./js/bootstrap.js"></script>
  <style>
    /* ã„ã‚Šãã†ãªã‚¯ãƒ©ã‚¹ï¼ˆ.ã‹ã‚‰å§‹ã¾ã‚‹ï¼‰ã‚„IDï¼ˆ#ã‹ã‚‰å§‹ã¾ã‚‹ï¼‰ã‚’ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã—ã¦æ›¸ã„ã¦ãŠãã€‚è‰²ãªã©å±æ€§ã¯ãƒ†ã‚­ãƒˆãƒ¼ãªã®ã§å¾Œã§é©å®œç›´ã™ã€‚ */
    /* ç›¤é¢ */
    .board {
      border-collapse: collapse;
      border-width: 1px;
      margin-top: 10rem;
      padding: 3rem;
      /*border-color: black;*/
      background: #0ab535;
    }

    .board .container-fluid .row {
      display: flex;
      justify-content: center;
      /* æ°´å¹³æ–¹å‘ã«ä¸­å¤®æƒãˆ */
      align-items: center;
      /* å‚ç›´æ–¹å‘ã«ä¸­å¤®æƒãˆ */

      min-width: 250px;
    }

    .board .container-fluid .row .col {
      display: flex;
      justify-content: center;
      /* æ°´å¹³æ–¹å‘ã«ä¸­å¤®æƒãˆ */
      align-items: center;
      /* å‚ç›´æ–¹å‘ã«ä¸­å¤®æƒãˆ */
    }

    .board .container-fluid .row .col>div {
      display: flex;
      justify-content: center;
      /* æ°´å¹³æ–¹å‘ã«ä¸­å¤®æƒãˆ */
      align-items: center;
      /* å‚ç›´æ–¹å‘ã«ä¸­å¤®æƒãˆ */
      width: 100%;
      /* å¹…ã‚’è¨­å®š */
      height: 100%;
      /* é«˜ã•ã‚’è¨­å®š */

    }

    /* ãƒã‚¹ */
    .cell {
      /*background: #0ab535;*/
      color: black;
      border-collapse: collapse;
      border-width: 10px;
      border-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      /* height: 50px;*/
      padding: 1px;
    }

    /* åˆ—é¸æŠãƒœã‚¿ãƒ³ */
    .col-btn {
      color: white;
    }

    /* åˆ—é¸æŠãƒœã‚¿ãƒ³ã®è‰² */
    .col-btn button {
      background-color: rgba(126, 184, 255, 0.804);
      border-color: antiquewhite;
    }

    .board td {
      /* background: #0ab535;*/
      color: black;
      border-collapse: collapse;
      border-width: 1px;
      border-color: black;
    }

    /* ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ */
    .player {
      color: white;
    }

    /* é§’ */
    .koma {
      background: red;
      border-radius: 50%;
    }

    /* å›è»¢ãƒœã‚¿ãƒ³ */
    #rotate-btn {
      background: orange;
      border-radius: 50%;
      margin-right: auto;
    }

    /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ */
    .name {
      color: black;
    }

    .header {
      position: sticky;
    }

    #restart-btn {
      background-color: aqua;
      margin-left: auto;
      /*display: flex;
            justify-content: flex-end;*/
    }

    .stone {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .stone.red {
      background-color: red;
      border-radius: 50%;
    }

    .stone.blue {
      background-color: blue;
      border-radius: 50%;
    }

    .card {
      height: 20rem;
      min-width: 15rem;
      /*min-height: 10rem;
            max-height: 20rem;*/
    }

    .log-block {
      margin-top: 10rem;
    }

    @media (min-width: 576px) {
      .log-block {
        margin-top: 2rem;
      }
    }

    .chat {
      display: flex;
      flex-direction: column;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .form {
      display: flex;
    }

    .input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
    }

    .submit {
      padding: 10px;
      border: 1px solid #ccc;
      background: #eee;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <!-- ã‚²ãƒ¼ãƒ åã¨ã‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼æã -->
  <header>
    <!-- navbar-light ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ–‡å­—è‰²ã‚’æŒ‡å®š -->
    <!-- ç”»é¢ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚Œã°ã€Œä¸‰ã€ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå‡ºã‚‹ã€‚å°ã•ã„åŠ æ¸›ã¯navbar-expand-lgã®lgéƒ¨åˆ†ã‚’å¤‰ãˆã‚‹ -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <!-- åå‰ hrefã§ãƒªãƒ³ã‚¯å…ˆæŒ‡å®šã€‚ä»®ã«ã€Œ#ã€(ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—)ã«æŒ‡å®š -->
        <a class="navbar-brand" href="#">
          <span class="gameName">ã‚³ãƒã‚¯ãƒˆãƒ•ã‚©ãƒ¼</span>
        </a>
        <!--ã“ã®buttonã‚¯ãƒ©ã‚¹ã§ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œã‚‹-->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarmenu"
          aria-controls="navbarmenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <!-- ãƒŠãƒ“ãƒãƒ¼ã®å†…å®¹ã€‚ãƒ†ã‚­ãƒˆãƒ¼ã«æ›¸ãã®ã§å¤‰ãˆã‚‹ãªã‚Šè¿½åŠ ãªã‚Šå‰Šé™¤ãªã‚Šã”è‡ªç”±ã« -->
        <div class="collapse navbar-collapse" id="navbarmenu">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="modal" data-bs-target="#exampleModal" href="#">ãƒ«ãƒ¼ãƒ«èª¬æ˜</a>
              <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
              <div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">ãƒ«ãƒ¼ãƒ«èª¬æ˜</h1>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                    </div>
                    <div class="modal-body">
                      <p>ãƒ«ãƒ¼ãƒ«èª¬æ˜ã‚’æ›¸ãã¾ã™ã€‚</p>
                    </div>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
                  </div>
                </div>
              </div>
            </li>
            <!-- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ä½œã‚‹ã€‚å¿…è¦ãªæ™‚ã«å‚ç…§ã§ãã‚‹ã‚ˆã†ã«æ›¸ã„ã¦ãŠãã€‚ä½¿ã‚ãªãã‚ƒæ¶ˆã™ã€‚ -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                è¨­å®š
              </a>
              <!-- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ä¸­èº«ã€‚ãƒœã‚¿ãƒ³ã ã‘ä½œã£ã¦ã¿ã‚‹ -->
              <ul class="dropdown-menu border-0">
                <li><a class="dropdown-item" href="#">åå‰å¤‰æ›´</a></li>
                <li><a class="dropdown-item" href="#">èƒŒæ™¯å¤‰æ›´</a></li>
                <li><a class="dropdown-item" href="#">çŸ³ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´</a></li>
              </ul>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"><span style="color: red">é€€å‡º</span></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <!-- ç›¤é¢6x6 -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12 col-md-10 col-lg-8">
        <div class="board m-5">
          <div class="player-names text-center">
            <p>
              <sapn class="myname">è‡ªåˆ†</sapn> vs. <span class="enemyname">ç›¸æ‰‹</span>
            </p>
            <div class="row">
              <div class="col text-start">
                <button type="button" id="restart-btn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
              </div>
              <div class="col text-end">
                <button type="button" id="rotate-btn">å›è»¢</button>
              </div>
            </div>
            <div id="whose-tarn" class="text-center mt-2"></div>
          </div>
          <div class="container-fluid">
            <div class="row">
              <div class="col cell border ratio ratio-1x1">
                <div>1</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>2</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>3</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>4</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>5</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>6</div>
              </div>
            </div>
            <div class="row">
              <div class="col cell border  ratio ratio-1x1">
                <div>1</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>2</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>3</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>4</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>5</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>6</div>
              </div>
            </div>
            <div class="row">
              <div class="col cell border ratio ratio-1x1">
                <div>1</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>2</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>3</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>4</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>5</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>6</div>
              </div>
            </div>
            <div class="row">
              <div class="col cell border ratio ratio-1x1">
                <div>1</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>2</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>3</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>4</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>5</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>6</div>
              </div>
            </div>
            <div class="row">
              <div class="col cell border ratio ratio-1x1">
                <div>1</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>2</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>3</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>4</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>5</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>6</div>
              </div>
            </div>
            <div class="row">
              <div class="col cell border ratio ratio-1x1">
                <div>1</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>2</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>3</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>4</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>5</div>
              </div>
              <div class="col cell border ratio ratio-1x1">
                <div>6</div>
              </div>
            </div>
            <div class="row border-0 col-btn text-center mt-1">
              <button id="col1-btn" class="col">
                <div>&#9651;</div>
              </button>
              <button id="col2-btn" class="col">
                <div>&#9651;</div>
              </button>
              <button id="col3-btn" class="col">
                <div>&#9651;</div>
              </button>
              <button id="col4-btn" class="col">
                <div>&#9651;</div>
              </button>
              <button id="col5-btn" class="col">
                <div>&#9651;</div>
              </button>
              <button id="col6-btn" class="col">
                <div>&#9651;</div>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- ãƒãƒ£ãƒƒãƒˆãªã©ã€‚é–“ã«åˆã‚ãªã‘ã‚Œã°å‰Šé™¤ -->
      <div class="col-sm-12 col-md-1 col-lg-3">
        <div class="log-block" style="display: flex; flex-direction: column;">
          <div class="card m-5 text-center" style="flex-grow: 1;">
            <div class="card-head">è¡Œå‹•å±¥æ­´</div>
            <ul class="log-list overflow-auto"></ul>
            <!--<div class="card-body">ã“ã“ã«æ–‡å­—ã‚’è¡¨ç¤º</div>-->
            <div id="status-message" class="card-body" style="flex-grow: 1;">å¯¾æˆ¦ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...</div>
          </div>
          <div class="card m-5 text-center chat" style="flex-grow: 1;">
            <div class="card-head">ãƒãƒ£ãƒƒãƒˆ</div>
            <ul class="messages"></ul>
            <div class="card-body" style="flex-grow: 1;">ã“ã“ã«æ–‡å­—ã‚’è¡¨ç¤º</div>
            <div class="card-footer" style="height: 4rem; align-items: center;">
              <form class="form">
                <input class="input" autocomplete="off" />
                <button class="submit" style="background-color: blue; color: white;">Send</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    let myId;
    function main() {

      const statusMessage = document.getElementById('status-message')

      const host = location.origin.replace(/^http/, 'ws');
      const ws = new WebSocket(host + '/ws');

      let myColor;

      const rows = 6;
      const cols = 6;
      const colbtn = new Array(6);
      const board = [];


      for (let i = 0; i < cols; i++) {
        board[i] = []; //ç©ºã£ã½ã®åˆ—
        // colbtn[i].disabled = true;
      }

      const boardContainer = document.querySelector(".board");
      colbtn[0] = document.getElementById("col1-btn");
      colbtn[1] = document.getElementById("col2-btn");
      colbtn[2] = document.getElementById("col3-btn");
      colbtn[3] = document.getElementById("col4-btn");
      colbtn[4] = document.getElementById("col5-btn");
      colbtn[5] = document.getElementById("col6-btn");

      const restart = document.getElementById("restart-btn");
      restart.addEventListener("click", restartGame);
      let whoseTarn = document.getElementById('whose-tarn');

      const rotateBtn = document.getElementById("rotate-btn");
      rotateBtn.addEventListener("click", () => {
        if (!myTurn || !gameStarted) return;
        ws.send(JSON.stringify({ type: "rotate", id: myId }));
      });


      let stone = "red";

      // ãƒœã‚¿ãƒ³ã‚’ä½œã‚‹
      for (let i = 0; i < cols; i++) {
        colbtn[i].addEventListener("click", () => dropStone(i));
      }

      // ç©ºã®ãƒœãƒ¼ãƒ‰ã‚’æç”»
      function drawBoard() {
        const cells = document.querySelectorAll(".cell");

        // ã¾ãšå…¨ã‚»ãƒ«ã®è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
        cells.forEach(cell => cell.classList.remove("red", "blue"));

        // é…åˆ—ã«å¿œã˜ã¦ã‚¹ãƒˆãƒ¼ãƒ³ã®è‰²ã‚’ã¤ã‘ã‚‹
        for (let col = 0; col < cols; col++) {
          for (let row = 0; row < board[col].length; row++) {
            const color = board[col][row]; // "red" or "yellow"
            const index = (rows - 1 - row) * cols + col; // é…åˆ— â†’ è¡¨ç¤ºã®ãƒãƒƒãƒ”ãƒ³ã‚°
            const stone = document.createElement("div");
            stone.classList.add("stone", color);
            cells[index].appendChild(stone);
          }
        }
      }

      function updateTurn() {
        if (!gameStarted) {
          whoseTarn.textContent = "";
          return;
        }
        if (myTurn) {
          whoseTarn.textContent = "myId";
        } else {
          whoseTarn.textContent = "ç›¸æ‰‹";
        }
      }

      // çŸ³ã‚’è½ã¨ã™å‡¦ç†
      function dropStone(col) {
        if (board[col].length >= rows) {
          alert("ã“ã®åˆ—ã¯é¸æŠã§ãã¾ã›ã‚“");
          setStatus("ã“ã®åˆ—ã¯ã›ã‚“ãŸãã§ãã¾ã›ã‚“");
          return;
        }
        if (!myTurn) {//ç”»é¢è¡¨ç¤º
          alert("ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã§ã™");
          setStatus("ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã§ã™");
          return;
        }
        if (!gameStarted) {
          alert("ã¾ã ç›¸æ‰‹ãŒæ¥ã¦ã„ã¾ã›ã‚“");

          return;
        }

        // board[col].push(stone); // çŸ³ã‚’è¿½åŠ 
        // drawBoard(); // å†æç”»
        // const row = board[col].length - 1;
        // victry(col, row, stone);


        // // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(stone)åˆ‡ã‚Šæ›¿ãˆ
        // if (stone === "red") {
        //   stone = "blue";
        // } else {
        //   stone = "red";
        // }
        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹ï¼ˆåˆ—ãŒæº€æ¯ãªã‚‰ï¼‰
        if (board[col].length === rows) {//ä¸‹ã‹ã‚‰â—‹â—‹åˆ—ã®1è¡Œç›®ã€2è¡Œç›®ã¨åŸ‹ã¾ã£ã¦ã„ã
          //â—‹â—‹åˆ—ã®é…åˆ—ã®åŸ‹ã¾ã‚Šå…·åˆãŒ6è¡Œç›®ã¾ã§ããŸã‚‰
          colbtn[col].disabled = true;
        }
        ws.send(JSON.stringify({ type: 'place', col, id: myId }))//stoneã‚’ç½®ã„ãŸå ´æ‰€send
      }

      // function victry(col, row, stone) {

      //   // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(stone)åˆ‡ã‚Šæ›¿ãˆ


      //   function countSameColor(goC, goR) {

      //     let count = 1; // è‡ªåˆ†è‡ªèº«ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
      //     //ç¸¦æ–¹å‘ï¼ˆä¸‹ã«3ã¤+1â¡èµ·ç‚¹ã‹ã‚‰åˆ—å›ºå®š(0)ã€è¡Œã‚’è² æ–¹å‘
      //     //æ¨ªæ–¹å‘ï¼ˆå·¦å³+1â¡èµ·ç‚¹ã‹ã‚‰è¡Œå›ºå®š(0)ã€åˆ—ã‚’æ­£æ–¹å‘ï¼†è² æ–¹å‘
      //     //æ–œã‚1ï¼ˆå³ä¸Šå·¦ä¸‹+1â¡ï¼ˆèµ·ç‚¹ã‹ã‚‰åˆ—ã€è¡Œã¨ã‚‚ã«æ­£æ–¹å‘ï¼‰+ï¼ˆèµ·ç‚¹ã‹ã‚‰åˆ—ã€è¡Œã¨ã‚‚ã«è² ï¼‰
      //     //æ–œã‚2ï¼ˆå·¦ä¸Šå³ä¸‹+1â¡ï¼ˆèµ·ç‚¹ã‹ã‚‰åˆ—ã«è² ã€è¡Œã«æ­£ï¼‰+ï¼ˆèµ·ç‚¹ã‹ã‚‰åˆ—ã«æ­£ã€è¡Œã«è² ï¼‰
      //     //ãã‚Œãã‚ŒstoneãŒèµ·ç‚¹ã¨åŒã˜ãªã‚‰count++;
      //     //ä¸¦ã‚“ã åˆè¨ˆãŒã©ã“ã‹ã—ã‚‰ã§4ã ã£ãŸã‚‰
      //     //ç”»é¢è¡¨ç¤ºâ†’"redã‚µã‚¤ãƒ‰ã®å‹åˆ©"
      //     // æ­£
      //     let c = col + goC;
      //     let r = row + goR;
      //     while (c >= 0 && c < cols && r >= 0 && r < rows && board[c][r] === stone) {
      //       count++;
      //       c += goC;
      //       r += goR;
      //     }

      //     // è² 
      //     c = col - goC;
      //     r = row - goR;
      //     while (c >= 0 && c < cols && r >= 0 && r < rows && board[c][r] === stone) {
      //       count++;
      //       c -= goC;
      //       r -= goR;
      //     }

      //     return count;

      //   }
      //   if (countSameColor(0, 1) >= 4 ||    // ç¸¦
      //     countSameColor(1, 0) >= 4 ||      // æ¨ª
      //     countSameColor(1, 1) >= 4 ||      // æ–œã‚ï¼ˆå³ä¸‹ï¼‰
      //     countSameColor(-1, 1) >= 4        // æ–œã‚ï¼ˆå·¦ä¸‹ï¼‰
      //   ) {

      //     for (let i = 0; i < cols; i++) {//åˆ—é¸æŠãƒœã‚¿ãƒ³åœæ­¢
      //       colbtn[i].disabled = true;
      //       alert(`${stone} ã‚µã‚¤ãƒ‰ã®å‹åˆ©`);
      //     }
      //   }
      //}

      // ç›¤é¢ã‚’90åº¦å›è»¢ã—ã¦ä¸‹ã«è©°ã‚ç›´ã™
      function rotateBoard() {
        // board: [col][row] â†’ [row][col]ã§å›è»¢
        const newBoard = Array.from({ length: cols }, () => []);
        for (let col = 0; col < cols; col++) {
          for (let row = 0; row < board[col].length; row++) {
            // 90åº¦å›è»¢: æ–°ã—ã„åˆ— = row, æ–°ã—ã„è¡Œ = cols-1-col
            newBoard[row][cols - 1 - col] = board[col][row];
          }
        }
        // ä¸‹ã«è©°ã‚ç›´ã™
        for (let col = 0; col < cols; col++) {
          // ç©ºè¦ç´ ã‚’é™¤å»ã—ã¦ä¸‹ã«è©°ã‚ã‚‹
          newBoard[col] = newBoard[col].filter(x => x);
        }
        for (let i = 0; i < cols; i++) board[i] = newBoard[i];
        // ã™ã¹ã¦ã®çŸ³è¦ç´ ã‚’æ¶ˆã™
        const stones = document.querySelectorAll('.stone');
        stones.forEach(stone => stone.remove());
        setStatus("å›è»¢ã•ã‚Œã¾ã—ãŸ");
        // æ–°ã—ã„é…ç½®ã§æç”»
        drawBoard();
      }

      function restartGame() {
        // // ãƒœãƒ¼ãƒ‰ã®çŠ¶æ…‹ã‚’ç©ºã«ã™ã‚‹
        // const stones = document.querySelectorAll('.stone'); // ã™ã¹ã¦ã®çŸ³è¦ç´ ã‚’å–å¾—
        // stones.forEach(stone => stone.remove());//stoneæ¶ˆã™ï¼ˆç‰©ç†

        // for (let i = 0; i < cols; i++) {
        //   board[i] = [];//stoneã‚’ã‘ã™ï¼ˆå†…éƒ¨
        //   colbtn[i].disabled = false; // ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
        // }

        // // çŠ¶æ…‹å¤‰æ•°ã‚’åˆæœŸåŒ–
        // gameStarted = false;
        // myTurn = false;

        // statusMessage.textContent = "ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...";

        // whoseTurn.textContent = "";

        // // å¿…è¦ãªã‚‰è‡ªåˆ†ã®è‰²ã‚„IDã‚‚åˆæœŸåŒ–ï¼ˆé€šå¸¸ã¯ä¸è¦ï¼‰

        // ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚»ãƒƒãƒˆé€šçŸ¥
        ws.send(JSON.stringify({ type: "reset", id: myId }));

      }
      function addLog(message) {
        const logList = document.querySelector('.log-list');
        if (!logList) return console.warn("log-list ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        const li = document.createElement('li');
        li.textContent = message;
        logList.appendChild(li);
        logList.scrollTop = logList.scrollHeight;
      }

      function setStatus(message) {
        const statusMessage = document.getElementById('status-message');
        if (!statusMessage) return console.warn("status-message ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        statusMessage.textContent = message;
        addLog(message);
      }
      

      // æœ€åˆã®æç”»

      drawBoard();

      //é€šä¿¡æ©Ÿèƒ½
      let gameStarted = false
      let myTurn = false; // è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ã‹ã©ã†ã‹ï¼ˆåˆæœŸã¯falseï¼‰

      ws.onmessage = (event) => {//å—ä¿¡
        const msg = JSON.parse(event.data)

        if (msg.type === 'full') {

          setStatus("æº€å“¡ã§ã™ã€‚è¦³æˆ¦ã¾ãŸã¯ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚");

          return
        }

        if (msg.type === 'init') {//åˆæœŸè¨­å®š
          myId = msg.id;
          myColor = msg.color;
          myTurn = msg.turn === myId;
          gameStarted = true;
          const stones = document.querySelectorAll('.stone'); // ã™ã¹ã¦ã®çŸ³è¦ç´ ã‚’å–å¾—
        stones.forEach(stone => stone.remove());//stoneæ¶ˆã™ï¼ˆç‰©ç†

        for (let i = 0; i < cols; i++) {
          board[i] = [];//stoneã‚’ã‘ã™ï¼ˆå†…éƒ¨
          colbtn[i].disabled = false; // ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
        }
          // for (let i = 0; i < cols; i++) {
          //           colbtn[i].disabled = false; // ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
          //         }
          statusMessage.textContent = ""
          setStatus("å¯¾æˆ¦ç›¸æ‰‹ãŒå…¥å®¤ã—ã¾ã—ãŸã€‚");

          updateTurn()
          return;
        }

        if (msg.type === "rotate") {
          rotateBoard();
          drawBoard();
          myTurn = msg.nextTurn === myId;
          updateTurn();
          return;
        }

        if (msg.type === 'update') {//ç›¸æ‰‹ã®è¡Œå‹•
          board[msg.col].push(msg.color)
          setStatus("stoneé…ç½®");

          drawBoard()
          if (msg.winner) {
            // å‹åˆ©æ™‚ã¯å…¨ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            for (let i = 0; i < cols; i++) {
              colbtn[i].disabled = true;
            }
            setTimeout(() => {
              // å‹è€…ãƒ»æ•—è€…ã§ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹ã‚’åˆ†ã‘ã‚‹
              if (msg.winner === myId) {
                setStatus("ã‚ãªãŸã®å‹ã¡ã§ã™ï¼");
                alert("ã‚ãªãŸã®å‹ã¡ã§ã™ï¼");

              } else {
                setStatus("ã‚ãªãŸã®è² ã‘ã§ã™â€¦");
                alert("ã‚ãªãŸã®è² ã‘ã§ã™â€¦");

              }
            }, 300); // 300mså¾…ã¤
            // å‹åˆ©æ™‚ã¯ã‚¿ãƒ¼ãƒ³è¡¨ç¤ºãƒ»åˆ‡ã‚Šæ›¿ãˆã‚’è¡Œã‚ãªã„
            return;
          }

          myTurn = msg.nextTurn === myId
          updateTurn()
          if (msg.message) {
            statusMessage.textContent = msg.message; // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
          }
          
          if (msg.type === 'chat') {
            const { id, text } = msg
            const messageList = document.querySelector('.messages')
            const li = document.createElement('li')
            if (id === myId) {
              li.textContent = `(${id})è‡ªåˆ†:` + text
            } else {
              li.textContent = id + ': ' + text
            }
            messageList.appendChild(li)
          }
        }

        const form = document.querySelector('.form')

        form.onsubmit = function (e) {
          e.preventDefault()
          const input = document.querySelector('.input')
          const text = input.value
          ws.send(JSON.stringify({ id: myId, text, type: 'chat' }))
          input.value = ''
          input.focus()
        }
        

      }

    }
    main();
  </script>
</body>

</html>

<!--
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>game</title>
    <style>
     
    </style>
  </head>
  <body>
    

    <script>
      function boardAction(){//ãƒœãƒ¼ãƒ‰ã®åˆ—é¸æŠ

      }
      function turnbuttonAction(){//

      }
      function u(){//è¡Œå‹•å¯å¦ã‚’å®šç¾©

      }
      
      function main() {
      }


      main()
    </script>
  </body>
</html>


<!-- <html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat App</title>
    <style>
      
      .chat {
        display: flex;
        flex-direction: column;
        height: 80vh;
      }
      .messages {
        flex: 1;
        overflow-y: auto;
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .form {
        display: flex;
      }
      .input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
      }
      .submit {
        padding: 10px;
        border: 1px solid #ccc;
        background: #eee;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="chat">
      <ul class="messages"></ul>
      <form class="form">
        <input class="input" autocomplete="off" />
        <button class="submit" style="background-color: blue; color: white;">SendğŸ’›</button>
      </form>
    </div>
    <div>
      <p>color</p>
      <button id = "redbtn" class="button" style="background-color: red; color: white">red</button>
      <button id = "bluebtn" class="button" style="background-color: blue; color: white">blue</button>
    </div>
    <canvas
      id="canvas"
      width="600"
      height="600"
      style="border: solid 1px black"
    ></canvas>

    <script>
      function main() {
        const host = location.origin.replace(/^http/, 'ws')
        const ws = new WebSocket(host + '/ws')
        const myId = self.crypto.randomUUID().substr(0, 8)

        const canvas = document.getElementById('canvas')
        const ctx = canvas.getContext('2d')

        let drawing = false
        let drawcolor = 'red'

        let redButton=document.getElementById("redbtn");
        let blueButton=document.getElementById("bluebtn");

        canvas.addEventListener('mousedown', (e) => {
          sendDrawingEvent(e.offsetX, e.offsetY, 'mousedown')
        })
        function mousedown() {
          drawing = true
          ctx.beginPath()
        }

        canvas.addEventListener('mousemove', (e) => {
          if (drawing) {
            sendDrawingEvent(e.offsetX, e.offsetY, 'mousemove')
          }
        })
        function mousemove(x, y) {
          if (drawing) {
            draw(x, y, true)
          }
        }

        canvas.addEventListener('mouseup', (e) => {
          sendDrawingEvent(e.offsetX, e.offsetY, 'mouseup')
        })
        function mouseup() {
          drawing = false
          ctx.beginPath()
        }

        canvas.addEventListener('mouseout', (e) => {
          sendDrawingEvent(e.offsetX, e.offsetY, 'mouseout')
        })
        function mouseout() {
          drawing = false
        }

        function draw(x, y, dragging) {
          if (dragging) {
            ctx.lineTo(x, y)
            ctx.strokeStyle=drawcolor;
            ctx.stroke()
          } else {
            ctx.moveTo(x, y)
          }
        }

        function sendDrawingEvent(x, y, control) {
          const message = JSON.stringify({ x, y, control, type: 'paint' })
          ws.send(message)
        }

        function changeColorToRed(){
           drawcolor = 'red'
          // sendColor('red')
        }
        function changeColorToBlue(){
          drawcolor = 'blue'
          //sendColor('blue')
          
        }

        function changeColorTo(colorTo){
          if(colorTo==='red'){
            changeColorToRed()
          }
          if(colorTo==='blue'){
            changeColorToBlue()
          }
        }
        function sendColor(colorTo){
          if(colorTo==='red'){
            drawcolor = 'red'
          }
          if(colorTo === 'blue'){
            drawcolor = 'blue'
          }
          const colorMsg = JSON.stringify({colorTo, type: 'color'})
          ws.send(colorMsg)
          
        }

        redButton.addEventListener('click',() => sendColor('red'));
        blueButton.addEventListener('click',() => sendColor('blue'));

        ws.onmessage = (event) => {
          const msg = JSON.parse(event.data)
          if (msg.type === 'paint') {
            const { x, y, control } = msg
            console.log({ control })
            if (control === 'mousedown') {
              mousedown()
            } else if (control === 'mouseup') {
              mouseup()
            } else if (control === 'mousemove') {
              mousemove(x, y)
            } else if (control === 'mouseout') {
              mouseout()
            }
          }
          if (msg.type === 'chat') {
            const { id, text } = msg
            const messageList = document.querySelector('.messages')
            const li = document.createElement('li')
            if (id === myId) {
              li.textContent = `(${id})è‡ªåˆ†:` + text
            } else {
              li.textContent = id + ': ' + text
            }
            messageList.appendChild(li)
          }
          if(msg.type === 'color'){
            const {colorTo} = msg;
            //drawcolor = {colorTo}
            changeColorTo(colorTo);
          }
        }

        const form = document.querySelector('.form')

        form.onsubmit = function (e) {
          e.preventDefault()
          const input = document.querySelector('.input')
          const text = input.value
          ws.send(JSON.stringify({ id: myId, text, type: 'chat' }))
          input.value = ''
          input.focus()
        }

        ws.onerror = function (error) {
          console.error('WebSocket Error: ', error)
        }
      }

      main()
    </script>
  </body>
</html>
 -->